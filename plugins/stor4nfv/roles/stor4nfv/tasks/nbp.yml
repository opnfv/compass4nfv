# #############################################################################
# Copyright (c) 2018 Intel Corp.
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
# #############################################################################
---

- name: render nbp inventory
  remote_user: root
  template:
    src: nbp.hosts.j2
    dest: $HOME/gopath/src/github.com/stor4nfv/stor4nfv/ci/nbp-ansible/nbp.hosts

- name: set nbp to csi
  remote_user: root
  shell: |
    cd $HOME/gopath/src/github.com/stor4nfv/stor4nfv/ci/nbp-ansible;
    sed -i 's/^nbp_plugin_type.*/nbp_plugin_type: csi/g' group_vars/common.yml

- name: run playbook
  remote_user: root
  shell: |
    cd $HOME/gopath/src/github.com/stor4nfv/stor4nfv/ci/nbp-ansible;
    ansible-playbook site.yml -i nbp.hosts | tee /var/log/stor4nfv-nbp.log
